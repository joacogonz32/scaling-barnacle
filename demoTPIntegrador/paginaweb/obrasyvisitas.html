<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoliMet - Obras y visitas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <div class="container header-inner">
            <a href="index.html" class="logo">
                <div class="logo-icon"><i class="fa-solid fa-landmark"></i></div>
                PoliMet
            </a>
            <nav class="nav-menu">
                <a href="#">Reseñas</a>
                <a href="obrasyvisitas.html">Explora</a>
                <a href="#">Exposiciones</a>
                <a href="#">Eventos</a>
                <a href="#">Entradas</a>
            </nav>
            <a href="signup.html" class="user-icon"><i class="fa-regular fa-user"></i></a>
        </div>
    </header>

    <section class="hero-obras" style="background-image: url('https://i.imgur.com/R38C8uJ.jpg');">
        <div class="hero-overlay"></div>
        <h1>La Colección PoliMet: Obras que Definen Nuestro Siglo</h1>
    </section>

    <div class="container modalidad-grid">
        <div class="modalidad-text">
            <h2>MODALIDAD</h2>
            <p>Descubra y conozca la historia detras de nuestras exposiciones y visitas guidas</p>
        </div>
        
        <div class="modalidad-card">
            <img src="https://i.imgur.com/G4Yt0Lg.jpg" alt="Obras">
            <div class="modalidad-label">OBRAS</div>
        </div>
        
        <div class="modalidad-card">
            <img src="https://i.imgur.com/1Zp7Qc9.jpg" alt="Visitas">
            <div class="modalidad-label">VISITAS GUIADAS</div>
        </div>
    </div>

    <div class="container popular-list">
        <div class="popular-header">
            <h2>NUESTRA COLECCIÓN (MAS POPULARES)</h2>
            <div class="divider-line"></div>
        </div>

        <div id="obras-container">
            <p>Cargando obras...</p>
        </div>

        <div style="text-align: center; margin-top: 80px; padding-bottom: 20px;">
            <button class="btn-dark" style="padding: 15px 40px; font-size: 0.9rem;">EXPLORAR MAS</button>
        </div>
    </div>

    <footer>
        <div class="container" style="display: flex; justify-content: space-between; padding-bottom: 50px;">
            <div style="flex:1">
                <h4 style="margin-bottom:20px;">Contacto</h4>
                <p style="color:#aaa; font-size:0.9rem;">polimetadmin@example.com</p>
                <p style="color:#aaa; font-size:0.9rem;">+5491178229110</p>
            </div>
            <div style="flex:1">
                <h4 style="margin-bottom:20px;">Nosotros</h4>
                <p><a href="#" style="color:#aaa; font-size:0.9rem;">Acerca de</a></p>
            </div>
            <div style="flex:1; text-align:right; font-family: 'Playfair Display'; font-size: 1.5rem;">
                <i class="fa-solid fa-landmark"></i> PoliMet
            </div>
        </div>
        <div class="footer-bottom">
            © 2025 PoliMet. Todos los derechos reservados
        </div>
    </footer>

    <script>
        const API_BASE_URL = 'http://localhost:8080/api';

        async function fetchObras() {
    const container = document.getElementById('obras-container');
    container.innerHTML = '<p>Cargando obras...</p>';

    try {
        const response = await fetch(`${API_BASE_URL}/obras`); 
        if (!response.ok) throw new Error('Error al cargar obras: ' + response.statusText);

        const obras = await response.json();
        
        const obrasToShow = obras.slice(0, 3); 

        let htmlContent = '';
        obrasToShow.forEach(obra => { 
            const artistaNombre = obra.artista ? obra.artista.nombre : 'Autor Desconocido';
            const imageUrl = obra.imagenUrl || 'https://via.placeholder.com/320x400?text=IMAGEN+NO+DISPONIBLE'; 

            htmlContent += `
                <div class="popular-item">
                    <img src="${imageUrl}" alt="${obra.nombre}">
                    <div class="popular-info">
                        <h3>${obra.nombre}</h3>
                        <span class="author">Autor: ${artistaNombre}</span>
                        <p>${obra.descripcion}</p>
                        <span class="author">Popularidad: ${obra.nivelPopularidad.toFixed(1)} / 5</span>
                    </div>
                </div>
            `;
        });

        container.innerHTML = htmlContent;
    } catch (error) {
        console.error("Error en fetchObras:", error);
        container.innerHTML = `<p style="color: red;">Error al conectar con la API: ${error.message}</p>`;
    }
}

        document.addEventListener("DOMContentLoaded", function() {
            fetchObras();
            // ... (El resto de la lógica de sesión/logout/dropdown) ...
            
            const usuarioRegistrado = localStorage.getItem('usuarioRegistrado') === 'true';
            const userIcon = document.querySelector('.user-icon');
            const headerContainer = document.querySelector('.header-inner');

            if (userIcon && usuarioRegistrado) {
                userIcon.classList.add('logged-in');
                userIcon.setAttribute('href', '#');
                userIcon.setAttribute('title', 'Sesión iniciada: ' + (localStorage.getItem('nombreUsuario') || 'Usuario'));

                const dropdownHTML = `
                    <div class="dropdown-menu" id="userDropdown">
                        <ul>
                            <li><a href="#"><i class="fa-regular fa-user"></i> Perfil</a></li>
                            <li><a href="#"><i class="fa-solid fa-gear"></i> Configuración</a></li>
                            <li><a href="membresias.html"><i class="fa-solid fa-crown"></i> Membresías</a></li>
                            <li><a href="#" id="btnLogout" class="logout-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i> Cerrar sesión</a></li>
                        </ul>
                    </div>
                `;
                headerContainer.insertAdjacentHTML('beforeend', dropdownHTML);

                const dropdown = document.getElementById('userDropdown');
                const btnLogout = document.getElementById('btnLogout');

                userIcon.addEventListener('click', function(e) {
                    e.preventDefault(); e.stopPropagation();
                    dropdown.classList.toggle('active');
                });

                document.addEventListener('click', function(e) {
                    if (!userIcon.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.classList.remove('active');
                    }
                });

                btnLogout.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('usuarioRegistrado');
                    localStorage.removeItem('idUsuario');
                    localStorage.removeItem('nombreUsuario');
                    window.location.reload();
                });
            }
        });
    </script>
</body>
</html>