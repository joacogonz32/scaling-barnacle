<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PoliMet - Obras y visitas</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>

    <header>
        <div class="container header-inner">
            <a href="index.html" class="logo">
                <div class="logo-icon"><i class="fa-solid fa-landmark"></i></div>
                PoliMet
            </a>
            <nav class="nav-menu">
                <a href="#">Reseñas</a>
                <a href="obrasyvisitas.html">Explora</a>
                <a href="#">Exposiciones</a>
                <a href="#">Eventos</a>
                <a href="#">Entradas</a>
            </nav>
            <a href="signup.html" class="user-icon"><i class="fa-regular fa-user"></i></a>
        </div>
    </header>

    <section class="hero-obras" style="background-image: url('<!-- PEGAR LINK FOTO MONA LISA GRANDE FONDO -->');">
        <div class="hero-overlay"></div>
        <h1>La Colección PoliMet: Obras que Definen Nuestro Siglo</h1>
    </section>

    <!-- MODALIDAD -->
    <div class="container modalidad-grid">
        <div class="modalidad-text">
            <h2>MODALIDAD</h2>
            <p>Descubra y conozca la historia detras de nuestras exposiciones y visitas guidas</p>
        </div>
        
        <div class="modalidad-card">
            <img src="<!-- PEGAR LINK FOTO OBRAS (LA CHICA DEL ARETE) -->" alt="Obras">
            <div class="modalidad-label">OBRAS</div>
        </div>
        
        <div class="modalidad-card">
            <img src="<!-- PEGAR LINK FOTO VISITAS (PALACIO) -->" alt="Visitas">
            <div class="modalidad-label">VISITAS GUIADAS</div>
        </div>
    </div>

    <!-- POPULARES -->
    <div class="container popular-list">
        <div class="popular-header">
            <h2>MAS POPULARES</h2>
            <div class="divider-line"></div>
        </div>

        <!-- Item 1 -->
        <div class="popular-item">
            <img src="<!-- PEGAR LINK FOTO RENOIR (ALMUERZO) -->" alt="Renoir">
            <div class="popular-info">
                <h3>El almuerzo de los remeros</h3>
                <span class="author">Autor: Pierre-Auguste Renoir</span>
                <p>Esta obra maestra del Impresionismo es un vibrante retrato de la vida social burguesa a orillas del río Sena, destacando la amistad, la moda y el placer efímero de la época.</p>
            </div>
        </div>

        <!-- Item 2 -->
        <div class="popular-item">
            <img src="<!-- PEGAR LINK FOTO NOCHE ESTRELLADA VAN GOGH -->" alt="Van Gogh">
            <div class="popular-info">
                <h3>La noche estrellada</h3>
                <span class="author">Autor: Vincent van Gogh</span>
                <p>Una de las obras más reconocidas del arte occidental. Muestra la vista exterior nocturna desde la ventana de la habitación del sanatorio de Saint-Rémy-de-Provence.</p>
            </div>
        </div>

        <!-- Item 3 -->
        <div class="popular-item">
            <img src="<!-- PEGAR LINK FOTO MUJER SENTADA (MODIGLIANI U OTRA) -->" alt="Obra">
            <div class="popular-info">
                <h3>Mujer sentada</h3>
                <span class="author">Autor: Amedeo Modigliani</span>
                <p>Retrato característico con formas alargadas y ojos almendrados vacíos, que evocan una profunda melancolía y elegancia atemporal.</p>
                <br>
            </div>
        </div>

        <!-- Item 4 -->
        <div class="popular-item">
            <img src="<!-- PEGAR LINK FOTO CABALLERO MANO EN PECHO -->" alt="El Greco">
            <div class="popular-info">
                <h3>El caballero de la mano en el pecho</h3>
                <span class="author">Autor: El Greco</span>
                <p>Una de las obras más famosas del artista, representando un noble español con un gesto solemne de juramento.</p>
            </div>
        </div>
        <div style="text-align: center; margin-top: 80px; padding-bottom: 20px;">
                <button class="btn-dark" style="padding: 15px 40px; font-size: 0.9rem;">EXPLORAR MAS</button>
            </div>
    </div>

    <footer>
        <div class="container" style="display: flex; justify-content: space-between; padding-bottom: 50px;">
            <div style="flex:1">
                <h4 style="margin-bottom:20px;">Contacto</h4>
                <p style="color:#aaa; font-size:0.9rem;">polimetadmin@example.com</p>
                <p style="color:#aaa; font-size:0.9rem;">+5491178229110</p>
                <p style="color:#aaa; font-size:0.9rem;">Santo Tome 3215 6B</p>
            </div>
            <div style="flex:1">
                <h4 style="margin-bottom:20px;">Nosotros</h4>
                <p><a href="#" style="color:#aaa; font-size:0.9rem;">Acerca de</a></p>
                <p><a href="#" style="color:#aaa; font-size:0.9rem;">Terminos y condiciones</a></p>
            </div>
            <div style="flex:1; text-align:right; font-family: 'Playfair Display'; font-size: 1.5rem;">
                <i class="fa-solid fa-landmark"></i> PoliMet
            </div>
        </div>
        <div class="footer-bottom">
            © 2025 PoliMet. Todos los derechos reservados
        </div>
    </footer>
    <script>
        const BASE_URL = 'http://localhost:8080';
        async function filtrarObras(filtros) {
            const params = new URLSearchParams();
            if (filtros.ubicacion) params.append('ubicacion', filtros.ubicacion);
            if (filtros.epoca) params.append('epoca', filtros.epoca);
            if (filtros.nombre) params.append('nombre', filtros.nombre);
            if (filtros.popularidad) params.append('popularidad', filtros.popularidad);
            
            const url = `${BASE_URL}/api/obras?${params.toString()}`;

            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error(`Error HTTP: ${response.status}`);
                }

                const obras = await response.json();
                console.log("Obras filtradas recibidas:", obras);
                
                return obras;
            } catch (error) {
                console.error("Error al obtener las obras:", error);
                return [];
            }
        }

        async function votarObra(idObra, puntaje, comentario) {
            const idUsuario = localStorage.getItem('idUsuario'); 
            
            if (!idUsuario) {
                alert("Debes iniciar sesión para poder votar una obra.");
                return;
            }

            const votoRequest = {
                idUsuario: Number(idUsuario), 
                puntaje: puntaje, 
                comentario: comentario
            };

            try {
                const response = await fetch(`${BASE_URL}/api/obras/${idObra}/votar`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(votoRequest),
                });

                if (!response.ok) {
                    const errorMessage = response.headers.get("Error") || "Error desconocido al votar.";
                    throw new Error(errorMessage);
                }

                const valoracionGuardada = await response.json();
                alert(`¡Voto exitoso! Obra #${idObra} calificada con ${valoracionGuardada.puntaje}. (Se actualizó la popularidad)`);

            } catch (error) {
                console.error("Error al votar la obra:", error.message);
                alert("No se pudo registrar el voto: " + error.message);
            }
        }

        document.addEventListener("DOMContentLoaded", function() {

            const usuarioRegistrado = localStorage.getItem('usuarioRegistrado') === 'true';
            const userIcon = document.querySelector('.user-icon');
            const headerContainer = document.querySelector('.header-inner');

            if (userIcon && usuarioRegistrado) {
                userIcon.classList.add('logged-in');
                userIcon.setAttribute('href', '#');

                const dropdownHTML = `
                    <div class="dropdown-menu" id="userDropdown">
                        <ul>
                            <li><a href="#"><i class="fa-regular fa-user"></i> Perfil</a></li>
                            <li><a href="#"><i class="fa-solid fa-gear"></i> Configuración</a></li>
                            <li><a href="membresias.html"><i class="fa-solid fa-crown"></i> Membresías</a></li>
                            <li><a href="#" id="btnLogout" class="logout-btn"><i class="fa-solid fa-arrow-right-from-bracket"></i> Cerrar sesión</a></li>
                    </ul>
                </div>
                `;
                headerContainer.insertAdjacentHTML('beforeend', dropdownHTML);

                const dropdown = document.getElementById('userDropdown');
                const btnLogout = document.getElementById('btnLogout');

                userIcon.addEventListener('click', function(e) {
                    e.preventDefault(); e.stopPropagation();
                    dropdown.classList.toggle('active');
                });

                document.addEventListener('click', function(e) {
                    if (!userIcon.contains(e.target) && !dropdown.contains(e.target)) {
                        dropdown.classList.remove('active');
                    }
                });

                btnLogout.addEventListener('click', function(e) {
                    e.preventDefault();
                    localStorage.removeItem('usuarioRegistrado');
                    localStorage.removeItem('idUsuario');
                    window.location.reload();
                });
            }
        });

    </script>
</body>
</html>